# rpp-consumer-node

Node.js consumer for RabbitMQ that processes Rust+ smart alarm events generated by the Rust game and logs them in a structured format.

---

## Features

- Connects to RabbitMQ
- Consumes alarm events from Rust+ smart devices published by [rustplusplus](https://github.com/Negri234279/rustplusplus), a fork with built-in RabbitMQ publishing
- Logs full event payloads
- Graceful shutdown handling (SIGINT / SIGTERM)
- Fully Dockerized
- Ready for production usage

---

## Event example

```json
{
  "active": false,
  "reachable": true,
  "everyone": true,
  "name": "YOUR BASE IS UNDER ATTACK",
  "message": "YOUR BASE IS UNDER ATTACK",
  "lastTrigger": 1567870268,
  "command": "317829368",
  "id": "357925331",
  "image": "smart_alarm.png",
  "location": "T13",
  "server": "Rusty Moose |EU Main|",
  "messageId": "1453794030969426105"
}
```

---

## ğŸ“¦ Available Images

### Docker Hub

```bash
docker pull negrii/rpp-consumer-node:latest
```

### GitHub Container Registry

```bash
docker pull ghcr.io/negri234279/rpp-consumer-node:latest
```

Also available by version:

```text
v1.0.0
v1.0.1
v1.1.0
```

---

## ğŸš€ Quick start with Docker Compose

### 1ï¸âƒ£ ğŸ§  Environment variables

| Variable          | Description       |
| ----------------- | ----------------- |
| RABBITMQ_HOST     | RabbitMQ host     |
| RABBITMQ_PORT     | RabbitMQ port     |
| RABBITMQ_USER     | RabbitMQ username |
| RABBITMQ_PASSWORD | RabbitMQ password |

---

### 2ï¸âƒ£ Run container

```bash
docker run -d \
  --name rpp-consumer-node \
  --env-file .env \
  --restart unless-stopped \
  -v rpp-consumer-node-logs:/app/logs \
  negrii/rpp-consumer-node:latest
```
---

### 3ï¸âƒ£ `docker-compose.yml`

```yaml
services:
  rpp-consumer-node:
    image: negrii/rpp-consumer-node:latest
    container_name: rpp-consumer-node
    env_file:
      - .env
    restart: unless-stopped
    volumes:
      - rpp-consumer-node-logs:/app/logs
  
volumes:
  rpp-consumer-node-logs:
```

---

### 4ï¸âƒ£ Start service

```bash
docker compose up -d
```

View logs:

```bash
docker logs -f rpp-consumer-node
```

---

### 5ï¸âƒ£ ğŸ—‘ï¸ Remove container and volume (full reset)

```bash
docker rm -f rpp-consumer-node
docker volume rm rpp-consumer-node-logs
```
> âš ï¸ This will remove all persisted state.

---


## ğŸ—ï¸ Development

```bash
docker compose -f 'docker-compose.dev.yml' up -d --build
```

---

## ğŸ”„ CI/CD

This project uses GitHub Actions for:

* Automatic versioning with semantic-release
* Creation of GitHub Releases
* Multi-arch builds with Docker Buildx
* Automatic push to Docker Hub and GHCR

Each push to main generates a new version if the commits require it.

---

## ğŸ” Security

* Container run as **non-root user**

---

## ğŸ‘¤ Author

**Negrii**
ğŸ”— [https://github.com/Negri234279](https://github.com/Negri234279)

---

## ğŸ“„ License

MIT License

---

## â­ Contributions

Pull requests and suggestions are welcome ğŸ™Œ

If you find this project useful, leave a â­ on GitHub